<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running Dashboard</title>
  <style>
    :root {
      --bg: #0a0e27;
      --bg-card: #141b2d;
      --accent: #f5c84c;
      --text: #f6f7fb;
      --muted: #8a8fa3;
      --error: #ff6666;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'SF Pro Display', sans-serif;
      background: var(--bg);
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(245, 200, 76, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(245, 200, 76, 0.03) 0%, transparent 50%);
      color: var(--text);
      min-height: 100vh;
      padding: 24px;
      overflow-x: hidden;
    }

    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      padding-bottom: 24px;
      border-bottom: 1px solid rgba(245, 200, 76, 0.1);
    }

    .title-group h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--text) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .status {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: #4ade80;
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .clock-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .progress-ring {
      position: absolute;
      transform: rotate(-90deg);
    }

    .progress-ring__circle {
      stroke: var(--accent);
      stroke-width: 4;
      fill: transparent;
      stroke-dasharray: 220;
      stroke-dashoffset: 220;
      transition: stroke-dashoffset 0.5s ease;
      stroke-linecap: round;
    }

    .clock-content {
      text-align: center;
      z-index: 1;
    }

    .clock-time {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
    }

    .clock-date {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .date-range {
      display: flex;
      gap: 8px;
      background: var(--bg-card);
      padding: 4px;
      border-radius: 12px;
      border: 1px solid rgba(245, 200, 76, 0.1);
    }

    .range-btn {
      background: transparent;
      border: none;
      color: var(--muted);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.3s ease;
      position: relative;
    }

    .range-btn:hover {
      color: var(--text);
      background: rgba(245, 200, 76, 0.05);
    }

    .range-btn.active {
      background: var(--accent);
      color: var(--bg);
      box-shadow: 0 4px 12px rgba(245, 200, 76, 0.3);
    }

    .range-label {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid rgba(245, 200, 76, 0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      border-color: rgba(245, 200, 76, 0.3);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
    }

    .card:hover::before {
      opacity: 1;
    }

    .span-2 {
      grid-column: span 2;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 0.85rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    .card-icon {
      width: 20px;
      height: 20px;
      stroke: var(--accent);
      opacity: 0.6;
    }

    .card-value {
      font-size: 3rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 8px;
      display: flex;
      align-items: baseline;
      gap: 8px;
    }

    .card-unit {
      font-size: 1.25rem;
      color: var(--muted);
      font-weight: 400;
    }

    .card-sub {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .counter {
      display: inline-block;
    }

    .quote-content {
      display: flex;
      align-items: center;
      gap: 24px;
    }

    .quote-text {
      flex: 1;
      font-size: 1.1rem;
      line-height: 1.6;
      color: var(--text);
      font-style: italic;
    }

    .quote-image {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--accent);
      cursor: pointer;
      transition: transform 0.3s ease;
      animation: headShake 2s ease-in-out infinite;
      transform-origin: 50% 80%;
    }

    .quote-image:hover {
      transform: scale(1.05);
    }

    @keyframes headShake {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-6deg); }
      50% { transform: rotate(0deg); }
      75% { transform: rotate(6deg); }
    }

    @media (max-width: 768px) {
      .span-2 {
        grid-column: span 1;
      }
      
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      
      .controls {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .quote-content {
        flex-direction: column;
        text-align: center;
      }
    }
  </style>
</head>
<body>

  <svg style="position: absolute; width: 0; height: 0;">
    <defs>
      <linearGradient id="gradientAccent" x1="0" x2="0" y1="0" y2="1">
        <stop offset="0%" stop-color="var(--accent)" stop-opacity="0.2"/>
        <stop offset="100%" stop-color="var(--accent)" stop-opacity="0"/>
      </linearGradient>
    </defs>
  </svg>

  <div class="dashboard">
    <header>
      <div class="title-group">
        <h1>Running Dashboard</h1>
        <div class="status">
          <span class="status-dot"></span>
          <span>Connected</span>
        </div>
      </div>
      
      <div class="clock-container">
        <svg class="progress-ring" width="80" height="80">
          <circle class="progress-ring__circle" stroke="var(--bg-card)" stroke-width="4" fill="transparent" r="35" cx="40" cy="40" style="opacity:0.2" />
          <circle id="week-ring" class="progress-ring__circle" r="35" cx="40" cy="40" />
        </svg>
        <div class="clock-content">
          <div class="clock-time" id="clock-time">00:00</div>
          <div class="clock-date" id="clock-date">Loading</div>
        </div>
      </div>
    </header>

    <div class="controls">
      <div class="date-range">
        <button class="range-btn active" data-range="week">Week</button>
        <button class="range-btn" data-range="month">Month</button>
        <button class="range-btn" data-range="year">Year</button>
      </div>
      <span class="range-label" id="range-label">Showing runs from...</span>
    </div>

    <div class="grid">
      
      <!-- Distance Card -->
      <div class="card span-2">
        <div class="card-header">
          <div class="card-title">Distance</div>
          <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
        </div>
        <div class="card-value"><span class="counter" id="range-km">0</span><span class="card-unit">km</span></div>
        <div class="card-sub"><span id="range-runs">0</span> runs in this range</div>
      </div>

      <!-- Avg Pace Card -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">Avg Pace</div>
          <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        </div>
        <div class="card-value" id="avg-pace" style="font-size: 2.5rem;">N/A</div>
        <div class="card-sub">/km</div>
      </div>

      <!-- Longest Run Card -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">Longest Run</div>
          <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        </div>
        <div class="card-value"><span class="counter" id="longest-run">0</span><span class="card-unit">km</span></div>
        <div class="card-sub">Peak performance</div>
      </div>

      <!-- This Month Card -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">This Month</div>
          <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        </div>
        <div class="card-value"><span class="counter" id="month-km">0</span><span class="card-unit">km</span></div>
        <div class="card-sub">Month to date</div>
      </div>

      <!-- Calories Card -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">Calories</div>
          <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        </div>
        <div class="card-value" id="calories" style="font-size: 2.5rem;">0</div>
        <div class="card-sub">Est. burn</div>
      </div>

      <!-- Total Runs Card -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">Total Runs</div>
          <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><polyline points="17 11 19 13 23 9"/></svg>
        </div>
        <div class="card-value"><span class="counter" id="all-runs">0</span></div>
        <div class="card-sub">All-time: <span id="all-km">0</span> km</div>
      </div>

      <!-- Coach Bennett Quote Card -->
      <div class="card span-2">
        <div class="card-header">
          <div class="card-title">Coach Bennett</div>
        </div>
        <div class="quote-content">
          <p class="quote-text" id="quote-text">Loading...</p>
          <img 
            class="quote-image" 
            src="https://raw.githubusercontent.com/c15c/stravarun/refs/heads/main/bennetthead.png" 
            alt="Coach Bennett"
          />
        </div>
      </div>

    </div>
  </div>

  <script>
    const runningQuotes = [
    "A run isn't bad, it's just a bit sub-mediocre",
    "Celebrate!",
    "Count your victories in as many ways as you can",
    "Easy runs should feel easy",
    "Every finish line is a starting line in disguise",
    "Every run has a purpose.",
    "Fill your life with great verbs. That will surround you with the right nouns and you will live a life that merits the best adjectives.",
    "If it's not easy, that doesn't mean it's too hard",
    "If you aren't running, you are recovering",
    "I'm talking about running. I'm also not talking about running.",
    "If you can't do the run you want, do the run you can.",
    "Maybe you can't means maybe you can",
    "Play at running.",
    "Release the Kraken!",
    "Run smart",
    "Running isn't boring, but some runners are.",
    "Something is better than nothing, cause those small bits of somethingness fill up the nothingness, and soon enough you'll have a lot of somethings",
    "Struggling does not mean failure. Struggling means successfully not giving up",
    "The end of one finish line is the beginning of a new starting line",
    "There are no guarantees when you cross the starting line",
    "This is about running, and it's also not about running",
    "We do hard things not so they become easy, but so we can take on even harder things",
    "We don't race to prove we're runners, we race to celebrate being runners.",
    "You are a bad-ass!",
    "You can get better at running, while not running",
    "You don't have to run every day to be a runner every day"
    ];

    function setRandomQuote() {
      const quoteEl = document.getElementById('quote-text');
      if (!quoteEl || runningQuotes.length === 0) return;
      const idx = Math.floor(Math.random() * runningQuotes.length);
      quoteEl.textContent = runningQuotes[idx];
    }

    function updateClock() {
      const now = new Date();
      const timeEl = document.getElementById('clock-time');
      const dateEl = document.getElementById('clock-date');
      if (!timeEl || !dateEl) return;

      const hours = now.getHours().toString().padStart(2, '0');
      const mins = now.getMinutes().toString().padStart(2, '0');
      timeEl.textContent = `${hours}:${mins}`;

      const options = { weekday: 'short', day: 'numeric', month: 'short' };
      dateEl.textContent = now.toLocaleDateString(undefined, options);
      
      // Update progress ring
      const dayOfWeek = now.getDay();
      const hoursInDay = now.getHours() + now.getMinutes() / 60;
      let daysPassed;
      if (dayOfWeek === 0) {
        daysPassed = 6 + hoursInDay / 24;
      } else {
        daysPassed = (dayOfWeek - 1) + hoursInDay / 24;
      }
      const weekProgress = daysPassed / 7;
      const circumference = 2 * Math.PI * 35;
      const offset = circumference * (1 - weekProgress);
      const ring = document.getElementById('week-ring');
      if (ring) {
        ring.style.strokeDashoffset = offset;
      }
    }

    function formatDateOnly(iso) {
      const [y, m, d] = iso.slice(0, 10).split('-');
      return new Date(y, m - 1, d).toLocaleDateString('en-AU', { day: 'numeric', month: 'short' });
    }
    
    function updateRangeLabel(range) {
      const label = document.getElementById('range-label');
      if (!label || !range) return;
    
      label.textContent =
        `Showing runs from ${formatDateOnly(range.start)} to ${formatDateOnly(range.end)}`;
    }

    function formatDateForAPI(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    async function fetchData(range) {
      const params = new URLSearchParams();

      if (range?.start && range?.end) {
        params.append('start', formatDateForAPI(range.start));
        params.append('end', formatDateForAPI(range.end));
      }

      const url = params.toString() ? `/api/strava?${params}` : '/api/strava';

      try {
        const res = await fetch(url);
        if (!res.ok) {
          throw new Error(`API ${res.status}`);
        }
        const data = await res.json();

        updateRangeLabel(data.range);

        const s = data.summary || {};
        const activities = data.activities || [];

        document.getElementById('range-km').textContent =
          s.totalKm != null ? s.totalKm.toFixed(1) : '0.0';
        document.getElementById('range-runs').textContent =
          s.totalRuns != null ? s.totalRuns : activities.length || 0;
        document.getElementById('avg-pace').textContent =
          s.avgPacePerKm || 'N/A';
        document.getElementById('longest-run').textContent =
          s.longestRunKm != null ? s.longestRunKm.toFixed(1) : '0.0';
        document.getElementById('calories').textContent =
          s.calories != null ? s.calories.toString() : '0';

        document.getElementById('all-km').textContent =
          s.allTimeKm != null ? s.allTimeKm.toFixed(1) : '0.0';
        document.getElementById('all-runs').textContent =
          s.allTimeRuns != null ? s.allTimeRuns.toString() : '0';

        const monthKmEl = document.getElementById('month-km');
        if (monthKmEl) {
          if (s.monthKm != null) {
            monthKmEl.textContent = s.monthKm.toFixed(1);
          } else {
            monthKmEl.textContent = '0.0';
          }
        }
      } catch (err) {
        console.error(err);
      }
    }

    function toDateOnly(d) {
      return new Date(d.getFullYear(), d.getMonth(), d.getDate());
    }

    function getWeekRange() {
      const now = new Date();
      const day = now.getDay();
      const diffToMonday = (day === 0 ? 6 : day - 1);

      const monday = new Date(now);
      monday.setDate(now.getDate() - diffToMonday);
      monday.setHours(0, 0, 0, 0);

      const sunday = new Date(monday);
      sunday.setDate(monday.getDate() + 6);
      sunday.setHours(23, 59, 59, 999);

      return {
        start: toDateOnly(monday),
        end: toDateOnly(sunday)
      };
    }

    function getMonthRange() {
      const now = new Date();
      return {
        start: new Date(now.getFullYear(), now.getMonth(), 1),
        end: new Date(now.getFullYear(), now.getMonth() + 1, 0)
      };
    }

    function getYearRange() {
      const now = new Date();
      return {
        start: new Date(now.getFullYear(), 0, 1),
        end: new Date(now.getFullYear(), 11, 31)
      };
    }

    document.querySelectorAll('.range-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document
          .querySelectorAll('.range-btn')
          .forEach(b => b.classList.remove('active'));

        btn.classList.add('active');

        let range;
        if (btn.dataset.range === 'week') range = getWeekRange();
        if (btn.dataset.range === 'month') range = getMonthRange();
        if (btn.dataset.range === 'year') range = getYearRange();

        setRandomQuote();
        fetchData(range);
      });
    });

    document.addEventListener('DOMContentLoaded', () => {
      setRandomQuote();
      updateClock();
      setInterval(updateClock, 30 * 1000);

      const bennettHead = document.querySelector('.quote-image');
      if (bennettHead) {
        bennettHead.addEventListener('click', () => {
          setRandomQuote();

          const activeBtn = document.querySelector('.range-btn.active');
          if (activeBtn) activeBtn.click();
        });
      }

      const weekBtn = document.querySelector('.range-btn[data-range="week"]');
      if (weekBtn) weekBtn.click();
    });
  </script>
</body>
</html>
