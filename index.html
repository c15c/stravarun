<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Running Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050609;
      --bg-card: #151822;
      --accent: #f5c84c;
      --text: #f6f7fb;
      --muted: #8a8fa3;
      --error: #ff6666;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top left, #262a3d, #050609 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 32px 32px;
    }
    .dashboard { max-width: 1200px; width: 100%; }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .title { font-size: 24px; font-weight: 700; }
    .status { display: flex; align-items: center; gap: 6px; font-size: 13px; color: var(--muted); }
    .status-dot { width: 8px; height: 8px; border-radius: 999px; background: #3bd675; }
    .clock { font-size: 20px; font-weight: 600; text-align: right; }
    .clock small { display: block; font-size: 12px; color: var(--muted); }

    .date-range {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
      font-size: 13px;
      color: var(--muted);
      flex-wrap: wrap;
    }
    .range-btn {
      background: #10121b;
      border: 1px solid #26293a;
      color: var(--text);
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 13px;
      cursor: pointer;
    }
    .range-btn.active {
      background: var(--accent);
      color: #11121a;
      border-color: transparent;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
    }
    .card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 18px 20px;
      min-height: 120px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.55);
    }
    .card-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-bottom: 12px;
    }
    .card-main { font-size: 32px; font-weight: 700; }
    .card-main span.small { font-size: 18px; font-weight: 500; color: var(--muted); margin-left: 4px; }
    .card-sub { margin-top: 6px; font-size: 12px; color: var(--muted); }
    .card-highlight { border: 1px solid rgba(245, 200, 76, 0.45); }

    .error-text { color: var(--error); font-size: 12px; margin-top: 8px; }

    .card-quote { grid-column: span 2; }
    .quote-inner { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .card-quote .card-main { font-size: 24px; line-height: 1.3; }
    .quote-image {
      max-height: 72px;
      max-width: 72px;
      border-radius: 50%;
      transform-origin: 50% 90%;
      animation: headshake 1.6s ease-in-out infinite;
      cursor: pointer;
    }

    @keyframes headshake {
      0% { transform: rotate(0deg); }
      20% { transform: rotate(-6deg); }
      40% { transform: rotate(6deg); }
      60% { transform: rotate(-4deg); }
      80% { transform: rotate(4deg); }
      100% { transform: rotate(0deg); }
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <header>
      <div>
        <div class="title">Running Dashboard</div>
        <div class="status">
          <span class="status-dot"></span>
          <span id="connection-status">Connected</span>
        </div>
      </div>
      <div class="clock">
        <span id="clock-time">00:00</span>
        <small id="clock-date">Loading…</small>
      </div>
    </header>

    <div class="date-range">
      <strong>Range:</strong>
      <button class="range-btn" data-range="week">Week</button>
      <button class="range-btn" data-range="month">Month</button>
      <button class="range-btn" data-range="year">Year</button>
      <span id="range-label"></span>
    </div>

    <div id="error-message" class="error-text" style="display:none;"></div>

    <div class="grid">
      <div class="card">
        <div class="card-title">This Range</div>
        <div class="card-main"><span id="range-km">0.0</span><span class="small">km</span></div>
        <div class="card-sub"><span id="range-runs">0</span> runs in range</div>
      </div>

      <div class="card">
        <div class="card-title">Avg Pace</div>
        <div class="card-main"><span id="avg-pace">0:00</span><span class="small">per kilometer</span></div>
        <div class="card-sub">Average pace for range</div>
      </div>

      <div class="card">
        <div class="card-title">Longest Run</div>
        <div class="card-main"><span id="longest-run">0.0</span><span class="small">kilometers</span></div>
        <div class="card-sub">Longest single run in range</div>
      </div>

      <div class="card card-highlight">
        <div class="card-title">Calories Burned</div>
        <div class="card-main"><span id="calories">0</span></div>
      </div>

      <div class="card card-highlight">
        <div class="card-title">This Month</div>
        <div class="card-main"><span id="month-km">0.0</span><span class="small">kilometers</span></div>
      </div>

      <div class="card card-highlight">
        <div class="card-title">Total Runs</div>
        <div class="card-main"><span id="all-runs">0</span></div>
      </div>

      <div class="card">
        <div class="card-title">All-Time Distance</div>
        <div class="card-main"><span id="all-km">0.0</span><span class="small">kilometers</span></div>
      </div>

      <div class="card card-quote">
        <div class="quote-inner">
          <div>
            <div class="card-title">Coach Bennett</div>
            <div class="card-main" id="quote-text">Every run has a purpose.</div>
          </div>
          <img
            class="quote-image"
            src="https://raw.githubusercontent.com/c15c/stravarun/refs/heads/main/bennett_head.png"
            alt="Coach Bennett"
          />
        </div>
      </div>
    </div>
  </div>

  <script>
    const runningQuotes = [
      “A run isn’t bad, it’s just a bit sub-mediocre”,  
      “Celebrate!”,  
      “Count your victories in as many ways as you can”,  
      “Easy runs should feel easy”,  
      “Every finish line is a starting line in disguise”,  
      “Every run has a purpose.”,  
      “Fill your life with great verbs. That will surround you with the right nouns and you will live a life that merits the best adjectives.”,  
      “If it’s not easy, that doesn’t mean it’s too hard”,  
      “If you aren't running, you are recovering”,  
      “I’m talking about running. I’m also not talking about running.”,  
      “If you can’t do the run you want, do the run you can.”,  
      “Maybe you can’t means maybe you can”,  
      “Play at running.”,  
      “Release the Kraken!”,  
      “Run smart”,  
      “Running isn't boring, but some runners are.”,  
      “Something is better than nothing, cause those small bits of somethingness fills up the nothingness, and soon enough you’ll have a lot of something’s”,  
      “Struggling does not mean failure. Struggling means successfully not giving up”,  
      “The end of one finish line is the beginning of a new starting line”,  
      “There are no guarantees when you cross the starting line”,  
      “This is about running, and it's also not about running”,  
      “We do hard things not so they become easy, but so we can take on even harder things”,  
      “We don't race to prove we're runners, we race to celebrate being runners.”,  
      “You are a bad-ass!”,  
      “You can get better at running, while not running”,  
      “You don’t have to run every day to be a runner every day.”

    ];

    function setRandomQuote() {
      const el = document.getElementById('quote-text');
      if (!el) return;
      el.textContent = runningQuotes[Math.floor(Math.random() * runningQuotes.length)];
    }

    function updateClock() {
      const now = new Date();
      document.getElementById('clock-time').textContent =
        now.getHours().toString().padStart(2, '0') + ':' +
        now.getMinutes().toString().padStart(2, '0');
      document.getElementById('clock-date').textContent =
        now.toLocaleDateString(undefined, { weekday: 'long', day: 'numeric', month: 'short' });
    }

    function formatDateOnly(iso) {
      const [y, m, d] = iso.slice(0, 10).split('-');
      return new Date(y, m - 1, d).toLocaleDateString();
    }

    function updateRangeLabel(range) {
      document.getElementById('range-label').textContent =
        `Showing runs from ${formatDateOnly(range.start)} to ${formatDateOnly(range.end)}`;
    }

    function getWeekRange() {
      const now = new Date();
      const diff = (now.getDay() + 6) % 7;
      const monday = new Date(now.getFullYear(), now.getMonth(), now.getDate() - diff);
      const sunday = new Date(monday.getFullYear(), monday.getMonth(), monday.getDate() + 6);
      return { start: monday, end: sunday };
    }

    function getMonthRange() {
      const now = new Date();
      return {
        start: new Date(now.getFullYear(), now.getMonth(), 1),
        end: new Date(now.getFullYear(), now.getMonth() + 1, 0)
      };
    }

    function getYearRange() {
      const now = new Date();
      return {
        start: new Date(now.getFullYear(), 0, 1),
        end: new Date(now.getFullYear(), 11, 31)
      };
    }

    async function fetchData(range) {
      const errorEl = document.getElementById('error-message');
      errorEl.style.display = 'none';

      try {
        const params = new URLSearchParams();
        params.append('start', range.start.toISOString().slice(0, 10));
        params.append('end', range.end.toISOString().slice(0, 10));

        const res = await fetch(`/api/strava?${params}`);
        if (!res.ok) throw new Error(res.status);

        const data = await res.json();
        updateRangeLabel(data.range);

        const s = data.summary;
        document.getElementById('range-km').textContent = s.totalKm.toFixed(1);
        document.getElementById('range-runs').textContent = s.totalRuns;
        document.getElementById('avg-pace').textContent = s.avgPacePerKm;
        document.getElementById('longest-run').textContent = s.longestRunKm.toFixed(1);
        document.getElementById('calories').textContent = s.calories;
        document.getElementById('month-km').textContent = s.monthKm.toFixed(1);
        document.getElementById('all-km').textContent = s.allTimeKm.toFixed(1);
        document.getElementById('all-runs').textContent = s.allTimeRuns;
      } catch (e) {
        errorEl.textContent = 'Failed to load data from Strava.';
        errorEl.style.display = 'block';
        document.getElementById('connection-status').textContent = 'Disconnected';
      }
    }

    document.querySelectorAll('.range-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.range-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        let range;
        if (btn.dataset.range === 'week') range = getWeekRange();
        if (btn.dataset.range === 'month') range = getMonthRange();
        if (btn.dataset.range === 'year') range = getYearRange();

        setRandomQuote();
        fetchData(range);
      });
    });

    document.addEventListener('DOMContentLoaded', () => {
      setRandomQuote();
      updateClock();
      setInterval(updateClock, 30000);
      document.querySelector('.range-btn[data-range="week"]').click();
    });
  </script>
</body>
</html>
